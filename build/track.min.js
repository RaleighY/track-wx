!function(t){var o={};function i(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=o,i.d=function(e,n,t){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(n,e){if(1&e&&(n=i(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)i.d(t,o,function(e){return n[e]}.bind(null,o));return t},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="",i(i.s=0)}([function(e,n,t){"use strict";t.r(n);var o={q:[],timer:null,upload:function(e){var n=this;e.timestamp=Date.now().valueOf(),this.q.push(e),this.timer||(this.timer=setTimeout(function(){n.flush()},1e3))},flush:function(){var e=this;0<this.q.length?(console.log(this.q.shift()),setTimeout(function(){e.flush()},1e3)):this.timer=null}};function i(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s={App:App,Page:Page,Component:Component,Behavior:Behavior,lastScene:0,lastCloseTime:0,keepAlive:3e3,sessionId:null,hook:function(e,n){return function(){n&&n.apply(this,arguments),e.apply(this,arguments)}},AppCallback:{onShow:function(n){s.scene=n.scene,Date.now().valueOf()-s.lastCloseTime<s.keepAlive?console.log("保持连接中"):(s.resetSessionId(),wx.getUserInfo({success:function(e){o.upload({event:"session",scene:n.scene,userInfo:e.userInfo,sessionId:s.sessionId})}}),wx.getNetworkType({success:function(e){o.upload({event:"network",type:e.networkType,sessionId:s.sessionId})}}),wx.getSystemInfo({success:function(e){o.upload({event:"systemInfo",systemInfo:e})}}))},onHide:function(){s.lastScene=s.scene,s.lastCloseTime=Date.now()}},PageCallback:{onShow:function(){o.upload({event:"view",path:this.route,sessionId:s.sessionId})},other:function(e){"tap"===e.type?o.upload({event:"tap",id:e.currentTarget.id,hesitate:e.timeStamp,x:e.detail.x,y:e.detail.y,sessionId:s.sessionId}):"getphonenumber"===e.type?e.detail.errMsg.match("ok")&&o.upload({event:"phoneNumber",hesitate:e.timeStamp,encryptedData:e.detail.encryptedData,iv:e.detail.iv,sessionId:s.sessionId}):o.upload({e:e,sessionId:s.sessionId})}},createSessionId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)})},resetSessionId:function(){this.sessionId=s.createSessionId()}},r=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,n,t){n&&i(e.prototype,n),t&&i(e,t)}(e,[{key:"init",value:function(){var n=this;App=function(e){return e.isApp=!0,s.App(n.decorate(e))},Page=function(e){return e.isPage=!0,s.Page(n.decorate(e))}}},{key:"decorate",value:function(e){if(e.isApp&&(e.onShow=s.hook(e.onShow?e.onShow:function(){},s.AppCallback.onShow),e.onHide=s.hook(e.onHide?e.onHide:function(){},s.AppCallback.onHide)),e.isPage)for(var n in e.onShow=s.hook(e.onShow?e.onShow:function(){},s.PageCallback.onShow),e)"function"==typeof e[n]&&"onShow"!==n&&"onLoad"!==n&&(e[n]=s.hook(e[n],s.PageCallback.other));return e}},{key:"setIdentity",value:function(e){o.upload({event:"identity",unionId:e.unionId,openId:e.openId,sessionId:s.sessionId})}}]),e}();n.default=new r}]);